# 名簿帳票ツール

小中学校向けの **名簿帳票自動生成 Windows デスクトップアプリ** です。

校務支援システムの Excel / CSV エクスポートを読み込み、名札・ラベル・名簿・台帳などの帳票を自動生成・直接印刷します。

---

## ダウンロード

最新版は [Releases ページ](https://github.com/atariryuma/meiboTool-releases/releases/latest) からダウンロードできます。

| ファイル | 用途 |
|----------|------|
| **meibo-tool-vX.X.X.zip** | **校内LAN共有向け（推奨）** — 展開するだけで全PCから利用可能 |
| **MeiboToolSetup-vX.X.X.exe** | インストーラー（個人PCに単独インストールする場合） |

---

## 主な機能

| 機能 | 説明 |
|------|------|
| **Excel テンプレート帳票** | ラベル（色付き・大・小・特大）・横名簿・縦一週間・男女一覧・掲示用名列表 |
| **レイアウト帳票** | 既存のレイアウトファイルを取り込んで直接印刷（台帳・調べ表・名列表 等） |
| **レイアウトエディター** | 画面上でレイアウトの編集・プレビュー・印刷が可能 |
| **写真差込** | 児童写真をフォルダから自動マッチングし帳票に差し込み |
| **特別支援学級** | 交流学級への自動統合・末尾追加の切り替え対応 |
| **職員名簿** | 職員向けレイアウト帳票にも対応 |
| **アプリ内自動更新** | 新バージョンの通知・ダウンロードをアプリ内で完結 |
| **校内LAN共有運用** | 共有フォルダに配置するだけで全PCから起動・データ共有 |

---

## 導入方法（校内LAN共有 — 推奨）

**校内LANの共有フォルダにアプリごと配置** すると、全PCから起動でき管理が最も簡単です。

### 手順

1. **meibo-tool-vX.X.X.zip** をダウンロード
2. 校内LANの共有フォルダに展開する

```
\サーバー名\共有フォルダ\
└── 名簿帳票ツール\          ← ZIP を展開した中身
    ├── 名簿帳票ツール.exe   ← これを各PCから起動
    ├── ★デスクトップにショートカットを作成.vbs
    ├── _internal\
    ├── テンプレート\
    └── レイアウト\
```

3. 各PCで「**★デスクトップにショートカットを作成.vbs**」をダブルクリック
4. 以降はデスクトップのショートカットから起動

### この方法のメリット

- **更新が1か所で済む** — 新バージョンの ZIP を上書き展開するだけで全PCに反映
- **名簿・写真・設定も共有** — 1台で設定すれば全PCから同じデータで使える
- **各PCへのインストール不要** — 共有フォルダから直接起動するだけ

---

## 導入方法（個人PCにインストール）

校内LANが使えない場合や個人PCで単独利用する場合はこちら。

1. **MeiboToolSetup-vX.X.X.exe** をダウンロードして実行
2. 画面の指示に従ってインストール
3. デスクトップにショートカットが自動作成されます

---

## 初回セットアップ（5ステップウィザード）

初めて起動すると **セットアップウィザード** が表示されます。

| ステップ | 内容 |
|---------|------|
| 1. 学校情報 | 学校名を入力（帳票タイトルに使われます） |
| 2. 名簿ファイル | 児童名簿・職員名簿の Excel / CSV ファイルを選択 |
| 3. 写真フォルダ | 児童写真の保存先を選択（写真付き帳票を使う場合） |
| 4. ユーザーパスワード | 全教員が起動時に入力するパスワード（名簿データの暗号化に使用） |
| 5. 管理者パスワード | 設定変更時に必要な管理者パスワード |

> セットアップ後も「ファイル → 管理者設定」からいつでも変更できます。

---

## 写真ファイルの命名規則

写真は以下のファイル名で自動マッチングされます（優先順）：

| ファイル名例 | 説明 |
|-------------|------|
| `1-1-01.jpg` | 学年-組-出席番号（ゼロ埋め） |
| `1-1-1.jpg` | 学年-組-出席番号 |
| `01.jpg` | 出席番号のみ（単学級向け） |
| `山田太郎.jpg` | 氏名 |

> 対応形式: `.jpg` `.jpeg` `.png` `.bmp` `.tiff` `.webp`（大文字小文字は区別しません）  
> サブフォルダ（`写真/1年/01.jpg` など学年別整理）にも対応しています。

---

## アプリの更新

新しいバージョンがリリースされると、起動時に自動で通知されます。

- **校内LAN共有の場合**: 新バージョンの ZIP をダウンロードして共有フォルダに上書き展開するだけです。
- **インストーラー版の場合**: 通知からそのまま更新できます。

---

## セキュリティについて

### なぜ名簿データの保護が必要か

校務支援システムからエクスポートした Excel / CSV には、児童の **氏名・生年月日・住所・保護者情報** などの個人情報がそのまま記載されています。

これを校内LANの共有フォルダにそのまま置くと、**ネットワーク上のどのPCからでも、誰でもコピー・持ち出しが可能な状態**になります。USBメモリへのコピーや、メール添付での外部送信も容易です。

本アプリでは、名簿データを **暗号化した状態でのみ保存** し、元の Excel / CSV は取り込み後に削除できる仕組みにしています。これにより、共有フォルダに個人情報の生データが残り続けるリスクを回避できます。

### 名簿データの保護

| 項目 | 内容 |
|------|------|
| **暗号化キャッシュ** | 読み込んだ名簿データは **AES-128-CBC + HMAC-SHA256**（Fernet）で暗号化して保存。共有フォルダ上のファイルを直接開いても中身は読めない |
| **元ファイル削除** | 名簿取り込み後、元の CSV/Excel ファイルの削除を選択可能（共有フォルダに生データを残さない） |
| **暗号鍵** | ユーザーパスワードから **PBKDF2-SHA256（100,000回反復）** で導出。パスワードを知らなければ復号不可 |

### アクセス制御

| 項目 | 内容 |
|------|------|
| **2層パスワード** | 「ユーザーPW（全教員共通・起動時に入力）」と「管理者PW（設定変更用）」の2層構成 |
| **パスワード保存** | PBKDF2-SHA256 ハッシュで保存（平文保存なし・タイミングセーフ比較） |
| **試行回数制限** | パスワード入力を5回間違えると30秒間ロックアウト |

### その他の安全対策

| 項目 | 内容 |
|------|------|
| **パス安全性** | パストラバーサル防止・シンボリックリンク解決済みの検証 |
| **排他制御** | 共有フォルダ上での同時アクセス時のファイルロック機構 |
| **LAN安全性** | UNC パスのタイムアウト保護（LAN切断時のハング防止） |
| **一時ファイル** | 起動時に残存 `.tmp` ファイルを自動クリーンアップ |
| **アトミック書込** | 設定・キャッシュは一時ファイル経由で書き込み（書込中クラッシュでもデータ破損なし） |

---

## 品質について

| 項目 | 内容 |
|------|------|
| 自動テスト | **1,603 件**のテストケースを全リリースで実行 |
| コードカバレッジ | 45% 以上を CI で保証 |
| 静的解析 | ruff リンターによるコード品質チェック |
| CI/CD | GitHub Actions でリント → テスト → ビルド → リリースを自動化 |

---

## 動作要件

- Windows 10 / 11
- 画面解像度 1024×768 以上推奨
- 配布版（exe）は Python のインストール不要

---

## お問い合わせ

不具合や要望は [Issues](https://github.com/atariryuma/meiboTool-releases/issues) からご報告ください。
